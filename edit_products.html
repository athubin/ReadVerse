<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Product</title>

<link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
body { font-family:'Roboto', sans-serif; background:#f0f2f5; }
.nav-wrapper { background-color:#4a90e2; }
.container-box { max-width:750px; margin:30px auto; padding:30px; background:#fff; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.1);}
.product-details { background:#f7f9fc; padding:20px; border-radius:10px; border-left:5px solid #4a90e2; margin-bottom:25px;}
.product-details p { margin:6px 0; font-size:16px; }
.product-details span { font-weight:600; }
img.preview { max-width:180px; margin:10px 0; border-radius:8px; border:1px solid #ccc; }
.btn { width:100%; background-color:#4a90e2; }
</style>
</head>

<body>
<nav>
  <div class="nav-wrapper" style="background-color:#4a90e2;">
    <a href="admin_home.html" class="brand-logo" style="padding-left:15px;">ReadVerse - Admin Dashboard</a>
    <ul class="right hide-on-med-and-down">
      <li><a href="admin_home.html">Home</a></li>
      <li><a href="product_list.html">Product List</a></li>
      <li><a href="add_product.html">Add Product</a></li>
      <li><a href="#" onclick="logout()">Logout</a></li>
    </ul>
  </div>
</nav>

<div class="container-box">
  <h4>Edit Product</h4>

  <!-- Display existing product -->
  <div class="product-details" id="productInfoBox">
    <p><span>ID:</span> <span id="d_id"></span></p>
    <p><span>Name:</span> <span id="d_name"></span></p>
    <p><span>Price:</span> â‚¹<span id="d_price"></span></p>
    <p><span>Category:</span> <span id="d_category"></span></p>
    <p><span>Description:</span><br><span id="d_description"></span></p>
    <p><span>Image:</span></p>
    <img id="d_image" class="preview" src="">
  </div>

  <form id="editProductForm">
    <h6>Modify Fields Below</h6>
    <div class="input-field"><input type="text" id="productName" required><label for="productName">Product Name</label></div>
    <div class="input-field"><input type="number" id="productPrice" required><label for="productPrice">Price</label></div>
    <div class="input-field"><input type="text" id="productCategory" required><label for="productCategory">Category</label></div>
    <div class="input-field"><textarea id="productDescription" class="materialize-textarea" required></textarea><label for="productDescription">Description</label></div>
    <div class="file-field input-field">
      <div class="btn"><span>Upload New Image</span><input type="file" id="productImageFile" accept="image/*"></div>
      <div class="file-path-wrapper"><input class="file-path validate" type="text"></div>
    </div>
    <img id="imagePreview" class="preview" src="">
    <button class="btn waves-effect waves-light" type="submit">Save Changes</button>
  </form>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
// Load product
document.addEventListener('DOMContentLoaded', () => {
  const productId = localStorage.getItem('editProductId');
  let products = JSON.parse(localStorage.getItem('products')) || [];
  const product = products.find(p => p.id == productId);
  if (!product) return alert("Product not found!");

  document.getElementById("d_id").innerText = product.id;
  document.getElementById("d_name").innerText = product.name;
  document.getElementById("d_price").innerText = product.price;
  document.getElementById("d_category").innerText = product.category;
  document.getElementById("d_description").innerText = product.description;
  document.getElementById("d_image").src = product.image;

  document.getElementById('productName').value = product.name;
  document.getElementById('productPrice').value = product.price;
  document.getElementById('productCategory').value = product.category;
  document.getElementById('productDescription').value = product.description;

  M.updateTextFields();
});

// Preview image
document.getElementById('productImageFile').addEventListener('change', function(){
  const reader = new FileReader();
  reader.onload = () => { document.getElementById('imagePreview').src = reader.result; }
  if(this.files[0]) reader.readAsDataURL(this.files[0]);
});

// Save changes
document.getElementById('editProductForm').addEventListener('submit', function(e){
  e.preventDefault();
  const id = localStorage.getItem('editProductId');
  let products = JSON.parse(localStorage.getItem('products')) || [];
  const product = products.find(p => p.id == id);
  if(!product) return;

  product.name = document.getElementById('productName').value;
  product.price = parseFloat(document.getElementById('productPrice').value);
  product.category = document.getElementById('productCategory').value;
  product.description = document.getElementById('productDescription').value;

  const file = document.getElementById('productImageFile').files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = () => { product.image = reader.result; saveProducts(products); }
    reader.readAsDataURL(file);
  } else { saveProducts(products); }
});

function saveProducts(products){
  localStorage.setItem('products', JSON.stringify(products));
  alert("Product updated successfully!");
  window.location.href = "product_list.html";
}

function logout(){
  localStorage.removeItem("loggedInUser");
  window.location.href = "login.html";
}

const file = document.getElementById('productImageFile').files[0];

if(file){
  const reader = new FileReader();
  reader.onload = () => { 
      product.image = reader.result; 
      saveProducts(products);
  }
  reader.readAsDataURL(file);
} else {
  // Preserve existing image or fallback
  product.image = product.image || 'default-image.png';
  saveProducts(products);
}

</script>

</body>
</html>
